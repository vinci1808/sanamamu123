T-CODE = A - Add a new Record to the Master File
T-CODE = U - Update an existing Record in the Master File
T-CODE = D - Delete an existing Record from the Master File
===========================================================
DATE: 26-JUL-2017              TIME: 11:50:33
STATUS OF EMPLOYEE MASTER UPDATE       PAGE: Z9

ID   CODE STATUS / MESSAGE
XXXXX  X  INVALID TRANSACTION CODE
XXXXX  A  RECORD ADDED SUCCESSFULLY
XXXXX  A  RECORD TO ADD EXISTS
XXXXX  U  RECORD UPDATED SUCCESSFULLY
XXXXX  U  RECORD TO UPDATE DOES NOT EXIST
XXXXX  D  RECORD DELETED SUCCESSFULLY
XXXXX  D  RECORD TO DELETE DOES NOT EXIST

DATE: 26-JUL-2017              TIME: 11:50:33
STATUS OF EMPLOYEE MASTER UPDATE       PAGE: Z9

RECS READ   : Z9
RECS ADDED  : Z9
RECS UPDATED: Z9
RECS DELETED: Z9
RECS ERROR  : Z9
==============================================================
FD  TRANSACTION-FILE.
01  TRANSACTION-RECORD.
    03  T-CODE        PIC X(01).
    88  VALID-CODE   VALUE 'A', 'U', 'D'.
    88  EMP-ADD  VALUE 'A'.
    88  EMP-UPD  VALUE 'U'.
    88  EMP-DEL  VALUE 'D'.
    03  T-ID     PIC X(05).
    03  T-DATA        PIC X(45).
FD  EMPLOYEE-MASTER.
01  MASTER-RECORD.
    03  EMP-ID        PIC X(05).
    03  EMP-DATA PIC X(45).
FD  REPORT-FILE.
01  REPORT-RECORD PIC X(60).
WORKING-STORAGE SECTION.
01  WS-COUNTERS.
    03  RECS-READ PIC 9(02) VALUE ZERO.
    03  RECS-ADDED    PIC 9(02) VALUE ZERO.
    03  RECS-UPDATED  PIC 9(02) VALUE ZERO.
    03  RECS-DELETED  PIC 9(02) VALUE ZERO.
    03  RECS-ERROR    PIC 9(02) VALUE ZERO.
01  WS-FILE-FLAG PIC X(01) VALUE 'N'.
    88  END-OF-FILE         VALUE 'Y'.
01  WS-EMP-FLAG       PIC X(01) VALUE 'N'.
    88  EMP-FOUND       VALUE 'Y'.
01  WS-ERROR-FLAG PIC X(01) VALUE 'N'.
    88  ERROR-OCCURRED           VALUE 'Y'.
01  DETAIL-LINE.
    03   P-ID     PIC X(07) VALUE SPACES.
    03  P-CODE        PIC X(03) VALUE SPACES.
    03  P-MESSAGE PIC X(50) VALUE SPACES.
PROCEDURE DIVISION.
PROCESS-PARA.
    IF VALID-CODE
    PERFORM READ-MASTER
    END-IF.
    EVALUATE TRUE
    WHEN EMP-ADD
       PERFORM PARA-ADD
    WHEN EMP-UPD
       PERFORM PARA-UPDATE
    WHEN EMP-DEL
       PERFORM PARA-DELETE
    WHEN OTHER
       MOVE 'INVALID TRAN CODE' TO P-MESSAGE
    END-EVALUATE.
    PERFORM WRITE-REPORT
    IF ERROR-OCCURRED
    ADD 1 TO RECS-ERROR
    MOVE 'N' TO WS-ERROR-FLAG
    END-IF
    PERFORM READ-TRANSACTION.
READ-MASTER.
    MOVE T-ID TO EMP-ID
    READ EMPLOYEE-MASTER
    INVALID KEY
       MOVE 'N' TO WS-EMP-FLAG
    NOT INVALID KEY
       MOVE 'Y' TO WS-EMP-FLAG
    END-READ.
WRITE-REPORT.
    MOVE T-ID TO P-ID
    MOVE T-CODE TO P-CODE
    WRITE REPORT-RECORD FROM DETAIL-LINE.
PARA-ADD.
    IF EMP-FOUND
    MOVE 'EMPLOYEE TO ADD EXISTS' TO P-MESSAGE
    MOVE 'Y' TO WS-ERROR-FLAG
    ELSE
    MOVE T-DATA TO EMP-DATA
    PERFORM WRITE-PARA
    END-IF.
PARA-UPDATE.
    IF EMP-FOUND
    MOVE T-DATA TO EMP-DATA
    PERFORM REWRITE-PARA
    ELSE
    MOVE 'EMPLOYEE TO UPDATE NOT FOUND' TO P-MESSAGE
    MOVE 'Y' TO WS-ERROR-FLAG
    END-IF.
PARA-DELETE.
    IF EMP-FOUND
    MOVE T-DATA TO EMP-DATA
    PERFORM DELETE-PARA
    ELSE
    MOVE 'EMPLOYEE TO UPDATE NOT FOUND' TO P-MESSAGE
    MOVE 'Y' TO WS-ERROR-FLAG
    END-IF.
WRITE-PARA.
    WRITE MASTER-RECORD
    INVALID KEY
       MOVE 'EMPLOYEE TO ADD EXISTS' TO P-MESSAGE
       MOVE 'Y' TO WS-ERROR-FLAG
    NOT INVALID KEY
       MOVE 'EMPLOYEE ADDED SUCCESSFULLY' TO P-MESSAGE
       ADD 1 TO RECS-ADDED
    END-WRITE.
REWRITE-PARA.
    REWRITE MASTER-RECORD
    INVALID KEY
       MOVE 'EMPLOYEE TO UPDATE NOT FOUND' TO P-MESSAGE
       MOVE 'Y' TO WS-ERROR-FLAG
    NOT INVALID KEY
       MOVE 'EMPLOYEE UPDATED SUCCESSFULLY' TO P-MESSAGE
       ADD 1 TO RECS-UPDATED
    END-REWRITE.
DELETE-PARA.
    DELETE EMPLOYEE-MASTER
    INVALID KEY
       MOVE 'EMPLOYEE TO DELETE NOT FOUND' TO P-MESSAGE
       MOVE 'Y' TO WS-ERROR-FLAG
    NOT INVALID KEY
       MOVE 'EMPLOYEE DELETED SUCCESSFULLY' TO P-MESSAGE
       ADD 1 TO RECS-DELETED
    END-REWRITE.
