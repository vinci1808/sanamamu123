01  WS-TEMP-TABLE.
    03  WS-WEEK		OCCURS 7 TIMES.
	05  WS-DAY	OCCURS 24 TIMES.
	    07  WS-TEMP	PIC 9(2)V9.
=============================================================
Calculate the Average Daily Temperature & Weekly Temperature
============================================================
01  WS-CTRS.
    03  WS-DAY-TOTAL	PIC 9(04)V9 VALUE ZERO.
    03  WS-WEEK-TOTAL	PIC 9(04)V9 VALUE ZERO.
    03  D-SUB		PIC 9(02)   VALUE ZERO.
    03  W-SUB		PIC 9(01)   VALUE ZERO.
    03  WS-AVG-TEMP	PIC 9(02)V9 VALUE ZERO.
PROCEDURE DIVISION.
    PERFORM VARYING W-SUB FROM 1 BY 1 UNTIL W-SUB > 7
	PERFORM VARYING D-SUB FROM 1 BY 1 UNTIL D-SUB > 24
	   ADD WS-TEMP(W-SUB, D-SUB) TO WS-DAY-TOTAL
	   DISPLAY 'PERFORM VARYING ' W-SUB, ' ', D-SUB
	END-PERFORM
	COMPUTE WS-AVG-TEMP = WS-DAY-TOTAL / 24
	ADD WS-DAY-TOTAL TO WS-WEEK-TOTAL
	MOVE ZERO TO WS-DAY-TOTAL
	DISPLAY 'AVG TEMP FOR DAY ', W-SUB, ' ', WS-AVG-TEMP
    END-PERFORM
    COMPUTE WS-AVG-TEMP = WS-WEEK-TOTAL / 168
    DISPLAY 'AVG TEMP FOR WEEK ', WS-AVG-TEMP
======================================================
01  TRANSACTION-RECORD.
    03  T-CODE		PIC X(01).
    03  T-ID		PIC X(05).
    03  T-NAME		PIC X(15).
    03  T-LOC		PIC X(03).
    03  T-DOB		PIC X(08).
    03  T-TECH		PIC X(05).
    03  T-EARN		PIC 9(05)V99.
    03  T-DEDN		PIC 9(05)V99.
T-CODE = A - Add a new Record to the Master File
T-CODE = U - Update an existing Record in the Master File
T-CODE = D - Delete an existing Record from the Master File
===========================================================
DATE: 26-JUL-2017				TIME: 11:50:33
STATUS OF EMPLOYEE MASTER UPDATE		PAGE: Z9

ID   CODE STATUS / MESSAGE
XXXXX  X  INVALID TRANSACTION CODE
XXXXX  A  RECORD ADDED SUCCESSFULLY
XXXXX  A  RECORD TO ADD EXISTS
XXXXX  U  RECORD UPDATED SUCCESSFULLY
XXXXX  U  RECORD TO UPDATE DOES NOT EXIST
XXXXX  D  RECORD DELETED SUCCESSFULLY
XXXXX  D  RECORD TO DELETE DOES NOT EXIST

DATE: 26-JUL-2017				TIME: 11:50:33
STATUS OF EMPLOYEE MASTER UPDATE		PAGE: Z9

RECORDS READ      : Z9 - A
RECORDS FOR ADD   : Z9 - B
	    ADDED : Z9 - B1
	DUPLICATE : Z9 - B2
RECORDS FOR UPDATE: Z9 - C
	  UPDATED : Z9 - C1
	DUPLICATE : Z9 - C2
RECORDS FOR DELETE: Z9 - D
	  DELETED : Z9 - D1
	DUPLICATE : Z9 - D2
RECORDS IN ERROR  : Z9 - E
++++++++++++++++++++++++++++
Explaination of above Counters -
E = A + B + C + D; B = B1 + B2; C = C1 + C2; D = D1 + D2
==============================================================
Data Validations before Adding or Updating Record in Employee Master -
1) Name should not be Blank
2) Location should not be Blank
3) DOB should be a Valid Date
4) Technology should not be Blank
5) Earnings should be > Zero
6) Earnings should be > Deductions
7) Deductions should be > 50% of Earnings
   If any Validation Fails, write Error Message & Bypass that Record
+++++++++++++++++++++++++++++++++++++++++
FD  TRANSACTION-FILE.
01  TRANSACTION-RECORD.
    03  T-CODE		PIC X(01).
	88  VALID-CODE	VALUE 'A', 'U', 'D'.
	88  EMP-ADD	VALUE 'A'.
	88  EMP-UPD	VALUE 'U'.
	88  EMP-DEL	VALUE 'D'.
    03  T-ID		PIC X(05).
    03  T-DATA		PIC X(45).
FD  EMPLOYEE-MASTER.
01  MASTER-RECORD.
    03  EMP-ID		PIC X(05).
    03  EMP-DATA	PIC X(45).
FD  REPORT-FILE.
01  REPORT-RECORD	PIC X(60).
WORKING-STORAGE SECTION.
01  WS-COUNTERS.
    03  RECS-READ	PIC 9(02) VALUE ZERO.
    03  RECS-ADDED	PIC 9(02) VALUE ZERO.
    03  RECS-UPDATED	PIC 9(02) VALUE ZERO.
    03  RECS-DELETED	PIC 9(02) VALUE ZERO.
    03  RECS-ERROR	PIC 9(02) VALUE ZERO.
01  WS-ERROR-FLAG	PIC X(01) VALUE 'N'.
    88  ERROR-OCCURRED		  VALUE 'Y'.
01  WS-FILE-FLAG	PIC X(01) VALUE 'N'.
    88  END-OF-FILE		  VALUE 'Y'.
01  WS-EMP-FLAG		PIC X(01) VALUE 'N'.
    88  EMP-FOUND		  VALUE 'Y'.
01  DETAIL-LINE.
    03  P-ID		PIC X(07) VALUE SPACES.
    03  P-CODE		PIC X(03) VALUE SPACES.
    03  P-MESSAGE	PIC X(50) VALUE SPACES.
PROCEDURE DIVISION.
MAIN-PARA.
    PERFORM INIT-PARA
    PERFORM PROCESS-PARA  UNTIL  END-OF-FILE
    PERFORM END-PARA
    STOP RUN.
INIT-PARA.
    OPEN INPUT  TRANSACTION-FILE
    OPEN I-O    EMPLOYEE-MASTER
    OPEN OUTPUT REPORT-FILE.
    PERFORM READ-TRANSACTION.
READ-TRANSACTION.
    READ TRANSACTION-FILE
       AT END
	  MOVE 'Y' TO WS-FILE-FLAG
       NOT AT END
	  ADD 1 TO RECS-READ
    END-READ.
PROCESS-PARA.
    IF VALID-CODE
	PERFORM READ-MASTER
    END-IF.
    EVALUATE TRUE
	WHEN EMP-ADD
	   PERFORM PARA-ADD
	WHEN EMP-UPD
	   PERFORM PARA-UPDATE
	WHEN EMP-DEL
	   PERFORM PARA-DELETE
	WHEN OTHER
	   MOVE 'INVALID TRAN CODE' TO P-MESSAGE
	   MOVE 'Y' TO WS-ERROR-FLAG
    END-EVALUATE.
    PERFORM WRITE-REPORT
    IF ERROR-OCCURRED
	ADD 1 TO RECS-ERROR
	MOVE 'N' TO WS-ERROR-FLAG
    END-IF
    PERFORM READ-TRANSACTION.
READ-MASTER.
    MOVE T-ID TO EMP-ID
    READ EMPLOYEE-MASTER
	INVALID KEY
	   MOVE 'N' TO WS-EMP-FLAG
	NOT INVALID KEY
	   MOVE 'Y' TO WS-EMP-FLAG
    END-READ.
WRITE-REPORT.
    MOVE T-ID	TO P-ID
    MOVE T-CODE TO P-CODE
    WRITE REPORT-RECORD FROM DETAIL-LINE.
PARA-ADD.
    IF EMP-FOUND
	MOVE 'EMPLOYEE TO ADD EXISTS' TO P-MESSAGE
	MOVE 'Y' TO WS-ERROR-FLAG
    ELSE
	MOVE T-DATA TO EMP-DATA
	PERFORM WRITE-PARA
    END-IF.
PARA-UPDATE.
    IF EMP-FOUND
	MOVE T-DATA TO EMP-DATA
	PERFORM REWRITE-PARA
    ELSE
	MOVE 'EMPLOYEE TO UPDATE NOT FOUND' TO P-MESSAGE
	MOVE 'Y' TO WS-ERROR-FLAG
    END-IF.
PARA-DELETE.
    IF EMP-FOUND
	MOVE T-DATA TO EMP-DATA
	PERFORM DELETE-PARA
    ELSE
	MOVE 'EMPLOYEE TO UPDATE NOT FOUND' TO P-MESSAGE
	MOVE 'Y' TO WS-ERROR-FLAG
    END-IF.
WRITE-PARA.
    WRITE MASTER-RECORD
	INVALID KEY
	   MOVE 'EMPLOYEE TO ADD EXISTS' TO P-MESSAGE
	   MOVE 'Y' TO WS-ERROR-FLAG
	NOT INVALID KEY
	   MOVE 'EMPLOYEE ADDED SUCCESSFULLY' TO P-MESSAGE
	   ADD 1 TO RECS-ADDED
    END-WRITE.
REWRITE-PARA.
    REWRITE MASTER-RECORD
	INVALID KEY
	   MOVE 'EMPLOYEE TO UPDATE NOT FOUND' TO P-MESSAGE
	   MOVE 'Y' TO WS-ERROR-FLAG
	NOT INVALID KEY
	   MOVE 'EMPLOYEE UPDATED SUCCESSFULLY' TO P-MESSAGE
	   ADD 1 TO RECS-UPDATED
    END-REWRITE.
DELETE-PARA.
    DELETE EMPLOYEE-MASTER
	INVALID KEY
	   MOVE 'EMPLOYEE TO DELETE NOT FOUND' TO P-MESSAGE
	   MOVE 'Y' TO WS-ERROR-FLAG
	NOT INVALID KEY
	   MOVE 'EMPLOYEE DELETED SUCCESSFULLY' TO P-MESSAGE
	   ADD 1 TO RECS-DELETED
    END-REWRITE.
============================================================